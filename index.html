<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Mi PFM">
  <title>Mi PFM - Finanzas Personales</title>
  <link rel="manifest" href="/manifest.json">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    #root {
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide icons as inline SVG components
    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const CreditCard = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
        <line x1="1" y1="10" x2="23" y2="10"></line>
      </svg>
    );

    const Store = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
    );

    const Calendar = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    const DollarSign = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="1" x2="12" y2="23"></line>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
      </svg>
    );

    const Hash = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="4" y1="9" x2="20" y2="9"></line>
        <line x1="4" y1="15" x2="20" y2="15"></line>
        <line x1="10" y1="3" x2="8" y2="21"></line>
        <line x1="16" y1="3" x2="14" y2="21"></line>
      </svg>
    );

    const Trash2 = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    function PFM() {
      const [transactions, setTransactions] = useState([]);
      const [showForm, setShowForm] = useState(false);
      const [formData, setFormData] = useState({
        amount: '',
        merchant: '',
        card: '',
        establishmentType: '',
        installments: '1',
        date: new Date().toISOString().split('T')[0]
      });

      const cards = ['Tarjeta 1', 'Tarjeta 2', 'Tarjeta 3'];
      const establishmentTypes = [
        'Supermercado',
        'Restaurante',
        'Transporte',
        'Servicios',
        'Entretenimiento',
        'Salud',
        'Tecnología',
        'Ropa',
        'Hogar',
        'Otro'
      ];

      useEffect(() => {
        const saved = localStorage.getItem('pfm-transactions');
        if (saved) {
          setTransactions(JSON.parse(saved));
        }
      }, []);

      const saveTransactions = (txns) => {
        localStorage.setItem('pfm-transactions', JSON.stringify(txns));
        setTransactions(txns);
      };

      const handleSubmit = () => {
        if (!formData.amount || !formData.merchant || !formData.card || !formData.establishmentType) {
          alert('Por favor completa todos los campos');
          return;
        }
        
        const newTransaction = {
          id: Date.now(),
          amount: parseFloat(formData.amount),
          merchant: formData.merchant,
          card: formData.card,
          establishmentType: formData.establishmentType,
          installments: parseInt(formData.installments),
          date: formData.date,
          createdAt: new Date().toISOString()
        };

        saveTransactions([newTransaction, ...transactions]);
        
        setFormData({
          amount: '',
          merchant: '',
          card: '',
          establishmentType: '',
          installments: '1',
          date: new Date().toISOString().split('T')[0]
        });
        setShowForm(false);
      };

      const deleteTransaction = (id) => {
        saveTransactions(transactions.filter(t => t.id !== id));
      };

      const formatCOP = (amount) => {
        return new Intl.NumberFormat('es-CO', {
          style: 'currency',
          currency: 'COP',
          minimumFractionDigits: 0
        }).format(amount);
      };

      const getInstallmentAmount = (transaction) => {
        return transaction.amount / transaction.installments;
      };

      const totalSpent = transactions.reduce((sum, t) => sum + t.amount, 0);

      return (
        <div className="min-h-screen bg-gray-50">
          <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 shadow-lg">
            <h1 className="text-2xl font-bold mb-2">Mi PFM</h1>
            <div className="text-3xl font-bold">{formatCOP(totalSpent)}</div>
            <div className="text-sm opacity-90 mt-1">Total gastado</div>
          </div>

          <div className="p-4">
            <button
              onClick={() => setShowForm(!showForm)}
              className="w-full bg-blue-600 text-white rounded-lg p-4 font-semibold flex items-center justify-center gap-2 shadow-md hover:bg-blue-700 transition"
            >
              <Plus size={24} />
              Agregar Transacción
            </button>
          </div>

          {showForm && (
            <div className="bg-white mx-4 mb-4 rounded-lg shadow-lg p-6">
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <DollarSign size={16} className="inline mr-1" />
                    Monto (COP)
                  </label>
                  <input
                    type="number"
                    value={formData.amount}
                    onChange={(e) => setFormData({...formData, amount: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="50000"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <Store size={16} className="inline mr-1" />
                    Establecimiento
                  </label>
                  <input
                    type="text"
                    value={formData.merchant}
                    onChange={(e) => setFormData({...formData, merchant: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Éxito, Rappi, etc."
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <CreditCard size={16} className="inline mr-1" />
                    Tarjeta
                  </label>
                  <select
                    value={formData.card}
                    onChange={(e) => setFormData({...formData, card: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    <option value="">Seleccionar tarjeta</option>
                    {cards.map(card => (
                      <option key={card} value={card}>{card}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Tipo de Establecimiento
                  </label>
                  <select
                    value={formData.establishmentType}
                    onChange={(e) => setFormData({...formData, establishmentType: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    <option value="">Seleccionar tipo</option>
                    {establishmentTypes.map(type => (
                      <option key={type} value={type}>{type}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <Hash size={16} className="inline mr-1" />
                    Cuotas
                  </label>
                  <input
                    type="number"
                    min="1"
                    value={formData.installments}
                    onChange={(e) => setFormData({...formData, installments: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                  {formData.installments > 1 && formData.amount && (
                    <p className="text-sm text-gray-600 mt-2">
                      {formatCOP(formData.amount / formData.installments)} por cuota
                    </p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <Calendar size={16} className="inline mr-1" />
                    Fecha
                  </label>
                  <input
                    type="date"
                    value={formData.date}
                    onChange={(e) => setFormData({...formData, date: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>

                <div className="flex gap-2 pt-2">
                  <button
                    onClick={handleSubmit}
                    className="flex-1 bg-blue-600 text-white rounded-lg p-3 font-semibold hover:bg-blue-700 transition"
                  >
                    Guardar
                  </button>
                  <button
                    onClick={() => setShowForm(false)}
                    className="flex-1 bg-gray-200 text-gray-700 rounded-lg p-3 font-semibold hover:bg-gray-300 transition"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
            </div>
          )}

          <div className="p-4 space-y-3">
            {transactions.length === 0 ? (
              <div className="text-center py-12 text-gray-500">
                <Store size={48} className="mx-auto mb-3 opacity-50" />
                <p>No hay transacciones aún</p>
                <p className="text-sm">Agrega tu primera compra</p>
              </div>
            ) : (
              transactions.map(transaction => (
                <div key={transaction.id} className="bg-white rounded-lg shadow p-4">
                  <div className="flex justify-between items-start mb-2">
                    <div className="flex-1">
                      <div className="font-semibold text-lg">{transaction.merchant}</div>
                      <div className="text-sm text-gray-600">{transaction.establishmentType}</div>
                    </div>
                    <button
                      onClick={() => deleteTransaction(transaction.id)}
                      className="text-red-500 hover:text-red-700 p-2"
                    >
                      <Trash2 size={18} />
                    </button>
                  </div>
                  
                  <div className="text-2xl font-bold text-blue-600 mb-2">
                    {formatCOP(transaction.amount)}
                  </div>
                  
                  <div className="grid grid-cols-2 gap-2 text-sm text-gray-600">
                    <div className="flex items-center gap-1">
                      <CreditCard size={14} />
                      {transaction.card}
                    </div>
                    <div className="flex items-center gap-1">
                      <Calendar size={14} />
                      {new Date(transaction.date).toLocaleDateString('es-CO')}
                    </div>
                  </div>

                  {transaction.installments > 1 && (
                    <div className="mt-3 pt-3 border-t border-gray-200">
                      <div className="text-sm font-medium text-gray-700 mb-1">
                        {transaction.installments} cuotas de {formatCOP(getInstallmentAmount(transaction))}
                      </div>
                      <div className="text-xs text-gray-500">
                        Pagos mensuales programados
                      </div>
                    </div>
                  )}
                </div>
              ))
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PFM />);
  </script>

  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }
  </script>
</body>
</html>
